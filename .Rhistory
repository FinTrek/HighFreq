})  # end sapply
# coerce back_test into matrix and transpose it
if (is.vector(back_test))
back_test <- t(back_test)
back_test <- t(back_test)
# coerce back_test into xts series
xts(back_test, order.by=index(x_ts[end_points[2:(NROW(end_points)-1)]]))
}
back_test <- roll_backtest(end_points=rutils::calc_endpoints(prices_ts, look_forward),
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
back_test
end_points
is.numeric(end_points)
is.numeric(Sys.Date() + 1:5)
Sys.Date() + 1:5
end_points
rutils::calc_endpoints(prices_ts, look_forward)
index(prices_ts[end_points, ])
identical(x_ts, prices_ts)
x_ts <- prices_ts
identical(x_ts, prices_ts)
end_points <- index(prices_ts[end_points, ])
which(end_points==index(x_ts))
end_points
match(end_points==index(x_ts))
match(end_points, index(x_ts))
end_points <- rutils::calc_endpoints(prices_ts, look_forward)
end_points
prices_ts[0, ]
library(HighFreq)
end_points <- rutils::calc_endpoints(prices_ts, look_forward)
end_points <- index(prices_ts[end_points, ])
end_points
end_points <- c(start(prices_ts), end_points)
end_points
back_test <- roll_backtest(end_points=rutils::calc_endpoints(prices_ts, look_forward),
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
back_test_old <- back_test
back_test <- HighFreq::roll_backtest(end_points=end_points,
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
library(HighFreq)
library(HighFreq)
library(HighFreq)
source("C:/Develop/R/scripts/stat_arb_func_2017_09_12.R")
prices_ts_all <- xts::as.xts(zoo::read.zoo(
file=file.path("C:/Develop/data",
"data prices close 2017-08-31.csv"),
header=TRUE, sep=",", FUN=as.Date, format="%m/%d/%Y"))
prices_ts_all <- prices_ts_all[, -which("XLR"==colnames(prices_ts_all))]
sum(is.na(prices_ts_all))
start_date <- start(prices_ts_all)
end_date <- end(prices_ts_all)
prices_ts <- prices_ts_all[paste(start_date, end_date, sep="/")]
prices_ts <- cbind(1:NROW(prices_ts), prices_ts)
colnames(prices_ts)[1] <- "index"
symbol_s <- c("XLP", "XLU")
model_type <- 1 # 0: OLS crossing the origin, 1: (default) ols, 2: TLS, 3: no-drift index, 4: no-drift dates
flag_sticky_stops <- TRUE  # use sticky stops, FALSE use regular stops
flag_print <- FALSE
flag_plot <- FALSE
trading_levels <- list(z_long_enter = -1.5,
z_long_profit = 0,
z_long_stop = -2.5,
z_short_enter = 1.5,
z_short_profit = 0,
z_short_stop = 2.5)
model_params <- list(
symbol_s=symbol_s,
model_type=model_type,
flag_print=flag_print,
flag_plot=flag_plot
)  # end list
trading_params <- list(
symbol_s=symbol_s,
trading_levels=trading_levels,
flag_sticky_stops=flag_sticky_stops,
flag_print=flag_print,
flag_plot=flag_plot
)  # end list
start_date <- start(prices_ts_all)
end_date <- end(prices_ts_all)
prices_ts <- prices_ts_all[paste(start_date, end_date, sep="/")]
start_point <- which(start_date==index(prices_ts_all))
end_point <- which(end_date==index(prices_ts_all))
look_forward <- 22
look_back <- 252  # about one year
end_points <- rutils::calc_endpoints(prices_ts, look_forward)
back_test <- HighFreq::roll_backtest(end_points=rutils::calc_endpoints(prices_ts, look_forward),
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
back_test
look_forward <- 2*22  # about twice monthly
end_points <- rutils::calc_endpoints(prices_ts, look_forward)
back_test <- HighFreq::roll_backtest(end_points=rutils::calc_endpoints(prices_ts, look_forward),
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
back_test_old <- back_test
end_points
end_points <- index(prices_ts[end_points, ])
end_points <- c(start(prices_ts), end_points)
end_points
back_test <- HighFreq::roll_backtest(end_points=end_points,
look_forward=look_forward,
look_back=look_back,
train_func = train_model,
trade_func = trade_model,
model_params = model_params,
trading_params = trading_params,
x_ts=prices_ts)
all.equal(back_test_old, back_test)
end_points
library(HighFreq)
?HighFreq::roll_backtest
library(HighFreq)
?HighFreq::roll_backtest
library(HighFreq)
?HighFreq::roll_backtest
library(HighFreq)
library(HighFreq)
ls()
library(HighFreq)  # load HighFreq
var_running <- 252*(24*60*60)^2*
HighFreq::run_variance(oh_lc=env_etf$VTI)
tail(var_running)
weight_s <- exp(0.1*1:win_dow)
source("C:/Develop/R/lecture_slides/scripts/ewma_model.R")
agg_regate <- function(oh_lc, lamb_das, ...) {
sapply(lamb_das, function(lamb_da) {
# simulate EWMA strategy and calculate Sharpe ratio
re_turns <-
simu_ewma(oh_lc=oh_lc, lamb_da=lamb_da, ...)[, "re_turns"]
sqrt(260)*sum(re_turns)/sd(re_turns)/NROW(re_turns)
})  # end sapply
}  # end agg_regate
agg_regate <- function(oh_lc, lamb_das, ...) {
sapply(lamb_das, function(lamb_da) {
# simulate EWMA strategy and calculate Sharpe ratio
re_turns <-
simu_ewma(oh_lc=oh_lc, lamb_da=lamb_da, ...)[, "re_turns"]
sqrt(260)*sum(re_turns)/sd(re_turns)/NROW(re_turns)
})  # end sapply
}  # end agg_regate
inter_val <- 31
lamb_das <- seq(0.001, 0.01, 0.001)
oh_lc <- rutils::env_etf$VTI["/2011"]
cl_ose <- Cl(oh_lc)
agg_regate(oh_lc, lamb_das, inter_val)
inter_val
library(googlesheets)
library(dplyr)
gs_auth(new_user=TRUE)
googlesheets::gs_ls()
getwd()
google_sheet <- gs_title("my_data")
google_sheet <- gs_title("FRE7241 grades Spring 2017")
google_sheet
gs_ws_ls(google_sheet)
google_sheet <- gs_title("my_data")
google_sheet
gs_ws_ls(google_sheet)
library(httr)
httr::set_config(config(ssl_verifypeer=0L))
gs_read(google_sheet)
gs_ws_ls(google_sheet)
tab_s <- gs_ws_ls(google_sheet)
tab_s[1]
library(httr)
httr::set_config(config(ssl_verifypeer=0L))
gs_read(google_sheet)
gs_read(google_sheet, ws=tab_s[1])
gs_read_csv(google_sheet, ws=tab_s[1])
gs_read_csv(google_sheet, ws=tab_s[2])
gs_download(google_sheet, ws=tab_s[1],
to="C:/Develop/R/lecture_slides/data/google_sheet.csv")
gs_browse(google_sheet)
library(HighFreq)  # load HighFreq
var_running <- HighFreq::run_variance(oh_lc=env_etf$VTI)
tail(var_running)
HighFreq::run_variance
foo <- diff(xts::.index(rutils::env_etf$VTI))
tail(foo)
foo <- xts::.index(rutils::env_etf$VTI)
tail(foo)
tail(rutils::env_etf$VTI)
foo <- xts::.index(rutils::env_etf$VTI)
class(foo)
class(index(rutils::env_etf$VTI))
foo <- xts(1:10, order.by=(Sys.Date() - 0:9))
foo
xts::.index(foo)
index(foo)
diff(index(foo))
as.numeric(index(foo))
var_running <- HighFreq::run_variance(oh_lc=env_etf$VTI, sca_le=FALSE)
tail(var_running)
inter_val <- 31
var_avg <- rutils::roll_sum(var_running,
win_dow=inter_val)/inter_val
args(rutils::roll_sum)
re_turns <- rutils::diff_xts(log(rutils::env_etf$VTI[, 4]))
end_points <- 0:NROW(re_turns)
len_gth <- NROW(end_points)
len_gth
look_back <- 31
start_points <-  end_points[
c(rep_len(1, look_back-1), 1:(len_gth-look_back+1))]
tail(start_points)
re_turns <- rutils::diff_xts(log(rutils::env_etf$VTI[, 4]))
end_points <- 0:NROW(re_turns)
len_gth <- NROW(end_points)
look_back <- 31
start_points <-  end_points[
c(rep_len(1, look_back-1), 1:(len_gth-look_back+1))]
var_running <- sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
(ret_s - mean(ret_s))^2 / (look_back-1)
})  # end sapply
NROW(var_running)
NROW(re_turns)
tail(var_running)
class(var_running)
len_gth
var_running <- sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex], ]
(ret_s - mean(ret_s))^2 / (look_back-1)
})  # end sapply
class(var_running)
tail(var_running)
class(re_turns)
var_running <- sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
sum(ret_s - mean(ret_s))^2 / (look_back-1)
})  # end sapply
class(var_running)
tail(var_running)
NROW(var_running)
tail(re_turns)
in_dex <- 100
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
ret_s
sum(ret_s - mean(ret_s))^2
mean(ret_s)
ret_s^2
sum((ret_s - mean(ret_s))^2)
var_running <- sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
sum((ret_s - mean(ret_s))^2)
}) / (look_back-1)  # end sapply
tail(re_turns)
var_running <- xts(var_running, order.by=index(re_turns))
var_running <- sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
sum((ret_s - mean(ret_s))^2)
}) / (look_back-1)  # end sapply
class(var_running)
var_running <- xts(var_running, order.by=index(re_turns))
install.packages("roll")
library(roll)  # load RcppRoll
class(var_running)
foo <- var_running
var_running <- roll::roll_var(re_turns, width=look_back)
tail(var_running)
tail(foo)
all.equal(var_running, foo)
colnames(foo) <- "VTI.Close"
all.equal(var_running, foo)
sum(is.na(var_running))
sum(is.na(foo))
head(var_running)
head(foo)
var_running <- roll::roll_var(re_turns, width=look_back)
colnames(var_running) <- "VTI.variance"
head(var_running)
sum(is.na(var_running))
look_back
var_running[1:(look_back-1)] <- 0
sum(is.na(var_running))
head(var_running)
library(microbenchmark)
summary(microbenchmark(
roll_sapply=sapply(2:len_gth, function(in_dex) {
ret_s <- re_turns[start_points[in_dex]:end_points[in_dex]]
sum((ret_s - mean(ret_s))^2)
}),
roll_roll=roll_var(re_turns, width=look_back),
times=10))[, c(1, 4, 5)]
install.packages("shinyapps")
install.packages("RcppArmadillo")
install.packages("RcppArmadillo")
install.packages("Rcpp11")
install.packages("RcppExamples")
install.packages("RcppParallel")
install.packages("RcppParallel")
devtools::find_rtools()
devtools::has_devel()
system("g++ -v")
Sys.getenv("PATH")
Sys.getenv("PATH")
Sys.getenv("PATH")
system("g++ -v")
Sys.getenv("PATH")
system("g++ -v")
Sys.getenv("PATH")
system("g++ -v")
Sys.getenv("PATH")
system("g++ -v")
library(HighFreq)
library(HighFreq)
install.packages("RcppArmadillo")
library(HighFreq)
library(HighFreq)
ls("package:HighFreq")
roll_variance
roll_var
roll_wsum
library(HighFreq)
ls("package:HighFreq")
library(HighFreq)
ls("package:HighFreq")
library(HighFreq)
library(HighFreq)
ls("package:HighFreq")
roll_var
roll_wsum
library(microbenchmark)
foo <- rnorm(1e6)
look_back <- 11
weight_s <- exp(0.1*1:look_back)
weight_s <- weight_s/sum(weight_s)
foob <- filter(foo, filter=weight_s[11:1], sides=1)
foob[1:(look_back-1)] <- 0
foobar <- HighFreq::roll_wsum(foo, weight_s)
summary(microbenchmark(
pure_r=filter(foo, filter=weight_s, sides=1),
r_cpp=HighFreq::roll_wsum(foo, weight_s),
r_utils=rutils::roll_sum(foo, look_back=30),
times=10))[, c(1, 4, 5)]
library(HighFreq)
library(HighFreq)
library(HighFreq)
library(microbenchmark)
library(HighFreq)
foo <- rnorm(1e6)
look_back <- 11
weight_s <- exp(0.1*1:look_back)
weight_s <- weight_s/sum(weight_s)
foobar <- HighFreq::roll_wsum(foo, weight_s)
foob <- filter(foo, filter=weight_s[11:1], sides=1)
foob[1:(look_back-1)] <- 0
summary(microbenchmark(
pure_r=filter(foo, filter=weight_s, sides=1),
r_cpp=HighFreq::roll_wsum(foo, weight_s),
r_utils=rutils::roll_sum(foo, look_back=30),
times=10))[, c(1, 4, 5)]
library(HighFreq)
foobar <- HighFreq::roll_wsum(foo, weight_s)
library(HighFreq)
foobar <- HighFreq::roll_wsum(foo, weight_s)
tail(foobar)
library(HighFreq)
foobar <- HighFreq::roll_wsum(foo, weight_s)
tail(foobar)
library(HighFreq)
library(HighFreq)
foo <- rnorm(1e6)
look_back <- 11
weight_s <- exp(0.1*1:look_back)
weight_s <- weight_s/sum(weight_s)
foo <- roll::roll_var(foo, weights=weight_s)
foo <- roll::roll_var(foo, weights=weight_s, width=NROW(weight_s))
foo <- rnorm(1e6)
look_back <- 11
weight_s <- exp(0.1*1:look_back)
weight_s <- weight_s/sum(weight_s)
foobar <- roll::roll_var(foo, weights=weight_s, width=NROW(weight_s))
class(foo)
foo <- matrix(rnorm(1e6), nc=1)
foob <- filter(foo, filter=weight_s[11:1], sides=1)
foobar <- HighFreq::roll_wsum(foo, weight_s)
tail(foob)
tail(foobar)
foobar <- roll::roll_var(foo, weights=weight_s, width=NROW(weight_s))
tail(foobar)
summary(microbenchmark(
pure_r=filter(foo, filter=weight_s, sides=1),
r_cpp=HighFreq::roll_wsum(foo, weight_s),
r_oll=roll::roll_var(foo, weights=weight_s, width=NROW(weight_s)),
times=10))[, c(1, 4, 5)]
library(microbenchmark)
summary(microbenchmark(
pure_r=filter(foo, filter=weight_s, sides=1),
r_cpp=HighFreq::roll_wsum(foo, weight_s),
r_oll=roll::roll_var(foo, weights=weight_s, width=NROW(weight_s)),
times=10))[, c(1, 4, 5)]
oh_lc <- SPY["2012-02-13"]
oh_lc <- HighFreq::SPY["2012-02-13"]
library(HighFreq)
look_back <- 1
x_ts <- HighFreq::SPY["2012-02-13"]
n_row <- NROW(x_ts)
n_row
num_agg <- n_row %/% look_back
num_agg
look_back*num_agg
price_s <- Cl(HighFreq::SPY["2012-02-13"])  # extract closing minutely prices
end_points <- seq_along(price_s)  # define end points
len_gth <- NROW(end_points)
look_back <- 11  # number of data points per look-back interval
start_points <- c(rep_len(1, look_back-1),
end_points[1:(len_gth-look_back+1)])
look_backs <- lapply(seq_along(end_points),
function(in_dex) {
start_points[in_dex]:end_points[in_dex]
})  # end lapply
look_backs[[1]]
look_backs[[2]]
look_backs[[3]]
look_backs[[22]]
library(HighFreq)
library(HighFreq)
?rowSums
ls()
rm(list = ls())
load("C:/Develop/R/lecture_slides/data/sp500.RData")
ls(env_sp500)
price_s <- eapply(env_sp500, quantmod::Cl)
class(price_s)
tail(price_s[[2]])
price_s <- rutils::do_call(cbind, price_s)
sum(is.na(price_s))
dim(price_s)
price_s <- na.locf(price_s)
price_s <- na.locf(price_s, fromLast=TRUE)
sum(is.na(price_s))
colnames(price_s)
colnames(price_s) <- sapply(colnames(price_s),
function(col_name) strsplit(col_name, split="[.]")[[1]][1])
colnames(price_s)
price_s[1:2, ]
price_s[1, ]
price_s <- xts(t(t(price_s) / as.numeric(price_s[1, ])),
order.by=index(price_s))
price_s[1, ]
or_der <- order(price_s[NROW(price_s), ])
sym_bols <- colnames(price_s)[or_der]
sym_bols <- sym_bols[seq.int(from=1, to=(NROW(sym_bols)-1), length.out=20)]
sym_bols
x11()
col_ors <- colorRampPalette(c("red", "blue"))(NROW(sym_bols))
col_ors <- col_ors[order(order(price_s[NROW(price_s), sym_bols]))]
par(mar=c(3, 3, 2, 2), oma=c(0, 0, 0, 0))
plot.zoo(price_s[, sym_bols], main="20 S&P500 stock prices (normalized)",
xlab=NA, ylab=NA, plot.type="single", col=col_ors)
legend(x="topleft", inset=0.05, cex=0.8,
legend=rev(sym_bols), col=rev(col_ors), lwd=6, lty=1)
num_stocks <- rowSums(price_s != 1)
num_stocks
NROW(num_stocks)
NROW(price_s)
sum(price_s[NROW(price_s), ] != 1)
tail*num_stocks
tail(num_stocks)
num_stocks <- rowSums(price_s != 1)
num_stocks[1] <- NCOL(price_s)
num_stocks <- rowSums(price_s != 1)
num_stocks[1] <- NCOL(price_s)
in_dex <- rowSums(price_s * (price_s != 1)) / num_stocks
val_id <- (price_s != 1)  # valid stocks
num_stocks <- rowSums(val_id)
num_stocks[1] <- NCOL(price_s)
in_dex <- rowSums(price_s * (val_id)) / num_stocks
per_centage <- rowSums((price_s < in_dex) & (val_id)) / num_stocks
in_dex <- zoo(in_dex, order.by=index(price_s))
x11(width=6, height=4)
par(mar=c(3, 3, 2, 2), oma=c(0, 0, 0, 0))
plot.zoo(in_dex, main="Average S&P500 stock prices (normalized from 1990)",
xlab=NA, ylab=NA, col="blue")
per_centage <- xts(per_centage, order.by=index(price_s))
plot.zoo(per_centage[-(1:2),],
main="Percentage of S&P500 stock prices below the average price",
xlab=NA, ylab=NA, col="blue")
install.packages("RQuantLib")
install.packages("RQuantLib", type="binary")
install.packages("RQuantLib", type="binary")
